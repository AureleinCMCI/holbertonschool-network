#!/bin/bash

# Exit on errors and unset variables
set -eu

# Backup original /etc/hosts
sudo cp /etc/hosts /etc/hosts.bak

# Modify localhost to 127.0.0.2 and disable IPv6
sudo sed -i '/^127\.0\.0\.1\s/s/127\.0\.0\.1/127.0.0.2/g' /etc/hosts
sudo sed -i '/^::1\s/s/^/#/' /etc/hosts  # Comment IPv6 localhost

# Add facebook.com -> 8.8.8.8 mapping
if ! grep -q "8.8.8.8 facebook.com" /etc/hosts; then
    echo "8.8.8.8 facebook.com" | sudo tee -a /etc/hosts
fi

# Update hostname resolution (optional but recommended)
HOSTNAME=$(hostname)
sudo sed -i "/127.0.0.2.*$HOSTNAME/d" /etc/hosts
echo "127.0.0.2 $HOSTNAME" | sudo tee -a /etc/hosts

echo "Configuration applied. Verify with:"
echo "  $ ping -c1 localhost    # Should show 127.0.0.2"
echo "  $ ping -c1 facebook.com # Should show 8.8.8.8"
